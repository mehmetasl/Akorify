// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  MODERATOR
}

model User {
  id            String        @id @default(cuid())
  email         String        @unique
  passwordHash  String
  role          Role          @default(USER) // "ADMIN" or "USER"
  name          String? // <--- Bunu ekle (Ad Soyad için)
  views         Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  favorites     Favorite[]
  emailVerified DateTime?
  contributions SongVersion[]
  xp            Int           @default(0) // Kullanıcının deneyim puanı
  levelTitle    String        @default("Çaylak Müzisyen") // Kullanıcının seviyesi için başlık
  image         String? // DiceBear URL'i burada tutulacak
  bio           String? // Hakkında yazısı
  location      String? // Şehiry
  socialLinks   String[]      @default([]) // [Twitter, Instagram, YouTube] 
  instruments   String[] // ["Gitar", "Vokal"] (PostgreSQL array destekler)

  @@map("users")
}

model Song {
  id         String        @id @default(cuid())
  title      String
  youtubeUrl String? // Opsiyonel, her şarkının videosu olmayabilir
  slug       String        @unique
  artist     String
  content    String
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  versions   SongVersion[]
  favorites  Favorite[]

  @@index([slug])
  @@index([artist])
  @@index([createdAt])
  @@map("songs")
}

model SongVersion {
  id       String  @id @default(cuid())
  songId   String
  userId   String
  content  String // Kullanıcının düzenlediği yeni içerik
  status   String  @default("PENDING") // "PENDING" (Bekliyor), "APPROVED" (Onaylandı), "REJECTED" (Red)
  title    String  @default("Versiyon")
  isPublic Boolean @default(false)

  createdAt DateTime @default(now())

  // İlişkiler
  song Song @relation(fields: [songId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("song_versions")
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  songId    String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  song Song @relation(fields: [songId], references: [id], onDelete: Cascade)

  // Bir kullanıcı bir şarkıyı sadece bir kez ekleyebilir
  @@unique([userId, songId])
  @@map("favorites")
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token]) // Aynı e-posta ve token kombinasyonu eşsiz olmalı
  @@map("verification_tokens")
}
